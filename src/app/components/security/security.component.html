<div class="security-settings-container">


  <main class="main-content">
    <div class="page-header">
      <div>
        <h1>Security & 2FA Settings</h1>
        <p class="subtitle">Enhance organization security by managing multi-factor authentication and user access policies.</p>
      </div>
      <div class="header-actions">
        <button class="btn btn-secondary" (click)="viewSecurityAuditLog()">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
            <circle cx="9" cy="9" r="7" stroke="currentColor" stroke-width="1.5"/>
            <path d="M9 5V9L12 11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
          View Audit Log
        </button>
        <button class="btn btn-primary" (click)="saveChanges()">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
            <path d="M14 2H4C3.44772 2 3 2.44772 3 3V15C3 15.5523 3.44772 16 4 16H14C14.5523 16 15 15.5523 15 15V3C15 2.44772 14.5523 2 14 2Z" stroke="currentColor" stroke-width="1.5"/>
            <path d="M11 2V7H7V2" stroke="currentColor" stroke-width="1.5"/>
            <path d="M6 12H12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
          Save Changes
        </button>
      </div>
    </div>

    <div class="status-banner">
      <div class="status-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M12 2L4 5V11C4 16.55 7.84 21.74 12 23C16.16 21.74 20 16.55 20 11V5L12 2Z" stroke="#10B981" stroke-width="2"/>
          <path d="M9 12L11 14L15 10" stroke="#10B981" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </div>
      <div class="status-content">
        <h3>Status: {{ twoFactorStatus }}</h3>
        <p>2FA is enforced for all users with the 'Administrator' role. Changes take effect immediately.</p>
      </div>
    </div>

    <div class="settings-section">
      <div class="section-card">
        <div class="section-header">
          <h2>Two-Factor Authentication (2FA)</h2>
        </div>

        <div class="enforce-2fa-section">
          <div class="enforce-content">
            <div class="enforce-icon">
              <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                <path d="M16 4L8 7V13C8 18.55 11.84 23.74 16 25C20.16 23.74 24 18.55 24 13V7L16 4Z" stroke="#0D6EFD" stroke-width="2"/>
                <path d="M13 16L15 18L19 14" stroke="#0D6EFD" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </div>
            <div class="enforce-text">
              <h3>Enforce 2FA for Administrators</h3>
              <p>Require all users with the 'Administrator' role to use 2FA for every login attempt.</p>
            </div>
          </div>
          <label class="toggle-switch">
            <input
              type="checkbox"
              [checked]="enforce2FAForAdmins"
              (change)="toggle2FAEnforcement()"
            >
            <span class="toggle-slider"></span>
          </label>
        </div>

        <div class="auth-methods">
          <div class="method-card recommended">
            <div class="method-header">
              <div class="method-icon">
                <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                  <rect x="6" y="4" width="20" height="24" rx="2" stroke="#0D6EFD" stroke-width="2"/>
                  <rect x="10" y="8" width="12" height="2" fill="#0D6EFD"/>
                  <rect x="10" y="12" width="12" height="2" fill="#0D6EFD"/>
                  <rect x="10" y="16" width="8" height="2" fill="#0D6EFD"/>
                </svg>
              </div>
              <div class="method-title">
                <h4>Authenticator App</h4>
                <span class="recommended-badge">RECOMMENDED</span>
              </div>
            </div>
            <p class="method-description">Use apps like Google Authenticator or Microsoft Authenticator to generate secure verification codes.</p>
            <button class="btn btn-primary btn-sm" (click)="configureAuthenticator()">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <circle cx="8" cy="8" r="6" stroke="currentColor" stroke-width="1.5"/>
                <path d="M8 5V8L11 10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
              </svg>
              Configure Method
            </button>
          </div>

          <div class="method-card">
            <div class="method-header">
              <div class="method-icon sms">
                <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                  <rect x="4" y="8" width="24" height="16" rx="2" stroke="#6B7280" stroke-width="2"/>
                  <path d="M4 12L16 19L28 12" stroke="#6B7280" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </div>
              <div class="method-title">
                <h4>SMS Verification</h4>
              </div>
            </div>
            <p class="method-description">Receive a 6-digit verification code via text message to your registered mobile phone number.</p>
            <button class="btn btn-secondary btn-sm" (click)="setupSMS()">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <circle cx="8" cy="8" r="6" stroke="currentColor" stroke-width="1.5"/>
              </svg>
              Setup SMS
            </button>
          </div>
        </div>
      </div>

      <div class="section-card">
        <div class="section-header">
          <h2>Roles & Permissions Definition</h2>
          <a href="javascript:void(0)" class="org-policy-link">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
              <path d="M8 2C11.3137 2 14 4.68629 14 8C14 11.3137 11.3137 14 8 14C4.68629 14 2 11.3137 2 8C2 4.68629 4.68629 2 8 2Z" stroke="currentColor" stroke-width="1.5"/>
              <path d="M8 5V8M8 11H8.01" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
            ORGANIZATION POLICY
          </a>
        </div>

        <div class="roles-grid">
          <div class="role-card" *ngFor="let role of roles">
            <div class="role-header">
              <div class="role-icon" [ngClass]="role.name">
                <svg *ngIf="role.name === 'administrator'" width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <path d="M12 2L4 5V11C4 16.55 7.84 21.74 12 23C16.16 21.74 20 16.55 20 11V5L12 2Z" stroke="currentColor" stroke-width="2"/>
                </svg>
                <svg *ngIf="role.name === 'booking-agent'" width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <circle cx="12" cy="8" r="4" stroke="currentColor" stroke-width="2"/>
                  <path d="M6 21C6 17.6863 8.68629 15 12 15C15.3137 15 18 17.6863 18 21" stroke="currentColor" stroke-width="2"/>
                </svg>
                <svg *ngIf="role.name === 'finance'" width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <rect x="3" y="6" width="18" height="13" rx="2" stroke="currentColor" stroke-width="2"/>
                  <circle cx="17" cy="12" r="2" fill="currentColor"/>
                </svg>
              </div>
              <div class="role-title">
                <h3>{{ role.label }}</h3>
                <span class="default-badge" *ngIf="role.isDefault">DEFAULT</span>
              </div>
            </div>
            <p class="role-description">{{ role.description }}</p>

            <div class="permissions-list">
              <div class="permission-item">
                <span class="permission-label">Can Issue Tickets</span>
                <label class="toggle-switch small">
                  <input
                    type="checkbox"
                    [checked]="role.permissions.canIssueTickets"
                    (change)="togglePermission(role, 'canIssueTickets')"
                  >
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <div class="permission-item">
                <span class="permission-label">Can Manage Users</span>
                <label class="toggle-switch small">
                  <input
                    type="checkbox"
                    [checked]="role.permissions.canManageUsers"
                    (change)="togglePermission(role, 'canManageUsers')"
                  >
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <div class="permission-item">
                <span class="permission-label">Can Refill Wallet</span>
                <label class="toggle-switch small">
                  <input
                    type="checkbox"
                    [checked]="role.permissions.canRefillWallet"
                    (change)="togglePermission(role, 'canRefillWallet')"
                  >
                  <span class="toggle-slider"></span>
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="section-card">
        <div class="section-header">
          <h2>User Security Status</h2>
        </div>

        <div class="table-container">
          <table class="security-table">
            <thead>
            <tr>
              <th>USER PROFILE</th>
              <th>2FA METHOD</th>
              <th>STATUS</th>
              <th>ACTIONS</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let user of users">
              <td class="user-cell">
                <div class="user-avatar">{{ user.initials }}</div>
                <div class="user-info">
                  <div class="user-name">{{ user.name }}</div>
                  <div class="user-email">{{ user.email }}</div>
                </div>
              </td>
              <td>
                  <span class="method-badge" *ngIf="user.twoFactorMethod">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                      <rect *ngIf="user.twoFactorMethod === 'app'" x="3" y="2" width="10" height="12" rx="1" stroke="currentColor" stroke-width="1.5"/>
                      <rect *ngIf="user.twoFactorMethod === 'sms'" x="2" y="4" width="12" height="8" rx="1" stroke="currentColor" stroke-width="1.5"/>
                    </svg>
                    {{ user.twoFactorMethod === 'app' ? 'App' : 'SMS' }}
                  </span>
                <span class="no-method" *ngIf="!user.twoFactorMethod">â€”</span>
              </td>
              <td>
                  <span class="status-badge" [ngClass]="user.status">
                    <span class="status-dot"></span>
                    {{ user.status === 'enabled' ? 'Enabled' : 'Disabled' }}
                  </span>
              </td>
              <td>
                <button class="action-button">Configure</button>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </main>
</div>

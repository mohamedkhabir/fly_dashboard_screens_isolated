<div class="cancellation-container">
  <header class="page-header">
    <div class="header-content">
      <div class="logo">
        <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
          <circle cx="16" cy="16" r="12" stroke="#0D6EFD" stroke-width="2"/>
          <path d="M16 8V16L20 20" stroke="#0D6EFD" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <span class="logo-text">B2B Travel Portal</span>
      </div>
      <nav class="breadcrumb">
        <a routerLink="/flight-search">Home</a>
        <span class="separator">/</span>
        <a routerLink="/booking-confirmation">Manage Bookings</a>
        <span class="separator">/</span>
        <span class="current">Cancellation & Refund</span>
      </nav>
      <div class="header-actions">
        <button class="btn btn-secondary" (click)="contactSupport()">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
            <path d="M14 3H4C3.44772 3 3 3.44772 3 4V11C3 11.5523 3.44772 12 4 12H6V15L9 12H14C14.5523 12 15 11.5523 15 11V4C15 3.44772 14.5523 3 14 3Z" stroke="currentColor" stroke-width="1.5"/>
          </svg>
          Need help with this?
        </button>
      </div>
    </div>
  </header>

  <main class="main-content">
    <div class="container">
      <div class="page-title-section">
        <h1>Process Cancellation & Refund</h1>
        <p class="subtitle">Review your itinerary and Amadeus fare conditions before proceeding.</p>
      </div>

      <div class="warning-banner">
        <div class="warning-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M12 2L22 20H2L12 2Z" stroke="#F59E0B" stroke-width="2" stroke-linejoin="round"/>
            <path d="M12 9V13M12 17H12.01" stroke="#F59E0B" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="warning-content">
          <h3>Irreversible Action</h3>
          <p>Once submitted, this cancellation request cannot be reversed. Refund amounts are subject to airline processing times (typically 7-14 business days).</p>
        </div>
      </div>

      <div class="content-grid">
        <div class="main-column">
          <div class="section-card booking-info">
            <div class="card-header">
              <h2>Booking Summary</h2>
              <div class="booking-badges">
                <span class="badge status">{{ bookingStatus }}</span>
                <span class="badge pnr">PNR: {{ pnr }}</span>
              </div>
            </div>

            <div class="flight-details">
              <div class="flight-route">
                <div class="route-point">
                  <div class="point-time">{{ flightInfo.departure.time }}</div>
                  <div class="point-location">
                    <strong>{{ flightInfo.departure.city }} ({{ flightInfo.departure.code }})</strong>
                  </div>
                  <div class="point-details">{{ flightInfo.departure.airport }}</div>
                  <div class="point-date">{{ flightInfo.departure.date }}</div>
                </div>

                <div class="route-arrow">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path d="M5 12H19M19 12L12 5M19 12L12 19" stroke="#0D6EFD" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                </div>

                <div class="route-point">
                  <div class="point-time">{{ flightInfo.arrival.time }}</div>
                  <div class="point-location">
                    <strong>{{ flightInfo.arrival.city }} ({{ flightInfo.arrival.code }})</strong>
                  </div>
                  <div class="point-details">{{ flightInfo.arrival.airport }}</div>
                  <div class="point-date">{{ flightInfo.arrival.date }}</div>
                </div>
              </div>

              <div class="flight-meta">
                <div class="meta-item">
                  <span class="meta-label">Airline</span>
                  <span class="meta-value">{{ flightInfo.airline }}</span>
                </div>
                <div class="meta-item">
                  <span class="meta-label">Class</span>
                  <span class="meta-value">{{ flightInfo.class }}</span>
                </div>
              </div>
            </div>
          </div>

          <div class="section-card method-selection">
            <div class="card-header">
              <h2>1. Select Method & Passengers</h2>
            </div>

            <div class="method-selector">
              <div class="method-option" [class.disabled]="voidWindowExpired">
                <label class="method-card">
                  <input
                    type="radio"
                    name="method"
                    value="refund"
                    [checked]="cancellationMethod === 'refund'"
                    (change)="setMethod('refund')"
                  >
                  <div class="method-content">
                    <div class="method-header">
                      <h3>Refund</h3>
                    </div>
                    <p class="method-description">Cancellation permitted with fee. USD 250.00 per refund.</p>
                  </div>
                </label>
              </div>

              <div class="method-option" [class.disabled]="voidWindowExpired">
                <label class="method-card" [class.disabled]="voidWindowExpired">
                  <input
                    type="radio"
                    name="method"
                    value="void"
                    [checked]="cancellationMethod === 'void'"
                    (change)="setMethod('void')"
                    [disabled]="voidWindowExpired"
                  >
                  <div class="method-content">
                    <div class="method-header">
                      <h3>Void</h3>
                      <span class="method-badge" *ngIf="voidWindowExpired">Non-refundable</span>
                    </div>
                    <p class="method-description" *ngIf="!voidWindowExpired">Any time ticket is non-refundable in case of cancel/no-show.</p>
                    <p class="method-description disabled-text" *ngIf="voidWindowExpired">Void window (24h) expired on 23 Nov 2023, 14:30.</p>
                  </div>
                </label>
              </div>
            </div>
          </div>

          <div class="section-card passengers-selection">
            <div class="card-header">
              <h2>Select Passengers</h2>
              <label class="select-all-checkbox">
                <input
                  type="checkbox"
                  [checked]="allSelected"
                  (change)="toggleAllPassengers()"
                >
                <span>Select All</span>
              </label>
            </div>

            <div class="passengers-list">
              <div
                class="passenger-row"
                *ngFor="let passenger of passengers"
                [class.selected]="passenger.selected"
              >
                <label class="passenger-checkbox">
                  <input
                    type="checkbox"
                    [checked]="passenger.selected"
                    (change)="togglePassenger(passenger)"
                  >
                  <div class="passenger-info">
                    <div class="passenger-name">{{ passenger.name }}</div>
                    <div class="passenger-ticket">Ticket: {{ passenger.ticketNumber }}</div>
                  </div>
                </label>
                <div class="passenger-refund">
                  <span class="refund-label">Est. Refund</span>
                  <span class="refund-amount">${{ passenger.refundAmount.toFixed(2) }}</span>
                </div>
              </div>
            </div>
          </div>

          <div class="section-card fare-rules">
            <div class="card-header">
              <h2>2. Fare Rules & Penalties</h2>
            </div>

            <div class="rules-content">
              <div class="rules-section">
                <h4>CANCELLATIONS</h4>
                <p>ANY TIME TICKET IS NON-REFUNDABLE IN CASE OF CANCEL/NO-SHOW.</p>
                <p>BEFORE DEPARTURE: CANCELLATIONS PERMITTED WITH FEE USD 250.00 FOR REFUND.</p>
                <p>AFTER DEPARTURE: TICKET IS NON-REFUNDABLE.</p>
              </div>

              <div class="rules-section">
                <h4>REFUNDS</h4>
                <p>REFUND OF UNUSED TAXES PERMITTED. SERVICE FEE MAY APPLY.</p>
                <p>REFUND CALCULATED AT DATE OF CANCELLATION.</p>
              </div>

              <button class="view-rules-button" (click)="viewFullRules()">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
                  <path d="M5 2H13L17 6V15C17 15.5523 16.5523 16 16 16H5C4.44772 16 4 15.5523 4 15V3C4 2.44772 4.44772 2 5 2Z" stroke="currentColor" stroke-width="1.5"/>
                  <path d="M13 2V6H17" stroke="currentColor" stroke-width="1.5"/>
                </svg>
                View Full GDS Rules
              </button>
            </div>
          </div>
        </div>

        <div class="side-column">
          <div class="section-card refund-summary">
            <div class="card-header">
              <h2>Refund Breakdown</h2>
            </div>

            <div class="summary-rows">
              <div class="summary-row">
                <span class="row-label">Base Fare Refund</span>
                <span class="row-value">${{ refundBreakdown.baseFareRefund.toFixed(2) }}</span>
              </div>
              <div class="summary-row">
                <span class="row-label">Tax Refund</span>
                <span class="row-value">${{ refundBreakdown.taxRefund.toFixed(2) }}</span>
              </div>
              <div class="summary-row penalty">
                <span class="row-label">Cancellation Penalty (CP)</span>
                <span class="row-value negative">{{ refundBreakdown.cancellationPenalty.toFixed(2) }}</span>
              </div>
              <div class="summary-row">
                <span class="row-label">Service Fee</span>
                <span class="row-value negative">{{ refundBreakdown.serviceFee.toFixed(2) }}</span>
              </div>
              <div class="summary-row total">
                <span class="row-label">Estimated Refund</span>
                <span class="row-value">${{ refundBreakdown.estimatedRefund.toFixed(2) }}</span>
              </div>
            </div>

            <div class="summary-note">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <circle cx="8" cy="8" r="7" stroke="#6B7280" stroke-width="1.5"/>
                <path d="M8 4V8M8 11H8.01" stroke="#6B7280" stroke-width="1.5" stroke-linecap="round"/>
              </svg>
              <span>Final amount subject to airline final audit</span>
            </div>
          </div>

          <div class="section-card original-booking">
            <div class="card-header">
              <h2>Original Booking</h2>
            </div>
            <div class="booking-amount">${{ originalBooking.toFixed(2) }}</div>
            <div class="booking-date">Ticketed: {{ ticketDate }}</div>
          </div>

          <div class="action-buttons">
            <button class="btn btn-secondary btn-block" (click)="keepBooking()">
              <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
                <path d="M11 14L6 9L11 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
              </svg>
              Keep Booking
            </button>
            <button class="btn btn-danger btn-block" (click)="confirmCancellation()">
              <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
                <circle cx="9" cy="9" r="7" stroke="currentColor" stroke-width="1.5"/>
                <path d="M6 9L8 11L12 7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
              </svg>
              Confirm Cancellation
            </button>
          </div>

          <div class="help-card">
            <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
              <circle cx="16" cy="16" r="14" fill="#E7F1FF"/>
              <path d="M16 10V16M16 22H16.01" stroke="#0D6EFD" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <h3>Need help with this?</h3>
            <p>Contact our 24/7 Ticketing Desk for assistance with complex cancellations.</p>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

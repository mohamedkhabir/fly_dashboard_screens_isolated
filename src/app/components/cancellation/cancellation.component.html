<div class="cancellation-page">


  <!-- Main Content -->
  <main class="main-content">
    <div class="container">


      <!-- Page Header -->
      <div class="page-header">
        <div class="page-header-left">
          <h1>Process Cancellation & Refund</h1>
          <div class="booking-meta">
            <span class="pnr-badge">PNR: {{ pnr }}</span>
            <span class="status-text">Status: <strong>{{ bookingStatus }}</strong></span>
            <span class="divider">|</span>
            <span class="ticket-date">Ticketed: <strong>{{ ticketDate }}</strong></span>
          </div>
        </div>
        <div class="page-header-right">
          <button class="btn-keep-booking" (click)="keepBooking()">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
              <path d="M10 12L6 8L10 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Keep Booking
          </button>
        </div>
      </div>

      <!-- Content Grid -->
      <div class="content-grid">
        <!-- Left Column -->
        <div class="left-column">
          <!-- Warning Banner -->
          <div class="warning-banner">
            <div class="warning-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M12 9V13M12 17H12.01M10.29 3.86L1.82 18C1.64 18.3 1.55 18.64 1.55 19C1.55 19.36 1.64 19.7 1.82 20C2 20.3 2.26 20.56 2.58 20.74C2.9 20.92 3.27 21.01 3.64 21H20.36C20.73 21.01 21.1 20.92 21.42 20.74C21.74 20.56 22 20.3 22.18 20C22.36 19.7 22.45 19.36 22.45 19C22.45 18.64 22.36 18.3 22.18 18L13.71 3.86C13.53 3.56 13.27 3.32 12.95 3.15C12.63 2.98 12.27 2.89 11.9 2.89C11.53 2.89 11.17 2.98 10.85 3.15C10.53 3.32 10.27 3.56 10.09 3.86H10.29Z" stroke="#D97706" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
            <div class="warning-content">
              <h3>Irreversible Action</h3>
              <p>Once submitted, this cancellation request cannot be reversed. Refund amounts are subject to airline processing times (typically 7-14 business days).</p>
            </div>
          </div>

          <!-- Section 1: Select Method & Passengers -->
          <div class="section-card">
            <div class="section-header">
              <h2>1. Select Method & Passengers</h2>
              <span class="amadeus-badge">AMADEUS DIRECT</span>
            </div>

            <div class="section-body">
              <!-- Cancellation Method -->
              <div class="form-group">
                <label class="form-label">Cancellation Method</label>
                <div class="method-toggle">
                  <button
                    class="method-btn"
                    [class.active]="cancellationMethod === 'refund'"
                    (click)="setMethod('refund')">
                    Refund
                  </button>
                  <button
                    class="method-btn"
                    [class.active]="cancellationMethod === 'void'"
                    [class.disabled]="voidWindowExpired"
                    (click)="setMethod('void')"
                    [disabled]="voidWindowExpired">
                    Void
                    <svg *ngIf="voidWindowExpired" width="14" height="14" viewBox="0 0 14 14" fill="none">
                      <rect x="2" y="5" width="10" height="8" rx="1" stroke="currentColor" stroke-width="1.5"/>
                      <path d="M4 5V3.5C4 2.11929 5.11929 1 6.5 1H7.5C8.88071 1 10 2.11929 10 3.5V5" stroke="currentColor" stroke-width="1.5"/>
                    </svg>
                  </button>
                </div>
                <p class="void-notice" *ngIf="voidWindowExpired">Void window (24h) expired on 23 Nov 2023, 14:30.</p>
              </div>

              <!-- Select Passengers -->
              <div class="form-group passengers-group">
                <label class="form-label">Select Passengers</label>
                <div class="passengers-list">
                  <div
                    class="passenger-item"
                    *ngFor="let passenger of passengers"
                    [class.selected]="passenger.selected">
                    <label class="passenger-checkbox">
                      <input
                        type="checkbox"
                        [checked]="passenger.selected"
                        (change)="togglePassenger(passenger)">
                      <span class="checkmark"></span>
                      <div class="passenger-info">
                        <span class="passenger-name">{{ passenger.name }}</span>
                        <span class="passenger-ticket">Ticket: {{ passenger.ticketNumber }}</span>
                      </div>
                    </label>
                    <span class="passenger-amount">${{ passenger.refundAmount.toFixed(2) }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Section 2: Fare Rules & Penalties -->
          <div class="section-card">
            <div class="section-header">
              <h2>2. Fare Rules & Penalties</h2>
            </div>

            <div class="section-body rules-body">
              <div class="rules-block">
                <h4>CANCELLATIONS</h4>
                <p>ANY TIME TICKET IS NON-REFUNDABLE IN CASE OF NO-SHOW.</p>
                <p>BEFORE DEPARTURE: CANCELLATIONS PERMITTED WITH FEE USD 250.00 FOR REFUND.</p>
                <p>AFTER DEPARTURE: TICKET IS NON-REFUNDABLE.</p>
              </div>

              <div class="rules-block">
                <h4>REFUNDS</h4>
                <p>REFUND OF UNUSED TAXES PERMITTED. SERVICE FEE MAY APPLY.</p>
                <p>REFUND CALCULATED AT DATE OF CANCELLATION.</p>
              </div>

              <button class="view-rules-btn" (click)="viewFullRules()">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                  <path d="M4 2H10L14 6V13C14 13.5523 13.5523 14 13 14H4C3.44772 14 3 13.5523 3 13V3C3 2.44772 3.44772 2 4 2Z" stroke="currentColor" stroke-width="1.5"/>
                  <path d="M10 2V6H14" stroke="currentColor" stroke-width="1.5"/>
                </svg>
                View Full GDS Rules
              </button>
            </div>
          </div>
        </div>

        <!-- Right Column -->
        <div class="right-column">
          <!-- City Image Card -->
          <div class="city-card">
            <img src="https://images.unsplash.com/photo-1534430480872-3498386e7856?w=400&h=160&fit=crop" alt="New York City Skyline">
            <div class="city-overlay">
              <span>Original Booking: ${{ originalBooking.toFixed(2) }}</span>
            </div>
          </div>

          <!-- Itinerary Summary -->
          <div class="summary-card itinerary-card">
            <h3>Itinerary Summary</h3>
            <div class="itinerary-route">
              <div class="route-item">
                <div class="route-icon departure">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <path d="M2 14H14M3 9L8 4L13 9" stroke="#0D6EFD" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
                <div class="route-details">
                  <span class="route-code">LHR · London Heathrow</span>
                  <span class="route-date">{{ flightInfo.departure.date }} · {{ flightInfo.departure.time }}</span>
                </div>
              </div>
              <div class="route-item">
                <div class="route-icon arrival">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <path d="M2 14H14M3 4L8 9L13 4" stroke="#0D6EFD" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
                <div class="route-details">
                  <span class="route-code">JFK · New York JFK</span>
                  <span class="route-date">{{ flightInfo.arrival.date }} · {{ flightInfo.arrival.time }}</span>
                </div>
              </div>
            </div>
            <div class="itinerary-meta">
              <div class="meta-row">
                <span class="meta-label">Airline</span>
                <span class="meta-value">British Airways (BA)</span>
              </div>
              <div class="meta-row">
                <span class="meta-label">Class</span>
                <span class="meta-value">Economy (Q)</span>
              </div>
            </div>
          </div>

          <!-- Refund Breakdown -->
          <div class="summary-card refund-card">
            <h3>Refund Breakdown</h3>
            <div class="breakdown-rows">
              <div class="breakdown-row">
                <span>Base Fare Refund</span>
                <span>${{ refundBreakdown.baseFareRefund.toFixed(2) }}</span>
              </div>
              <div class="breakdown-row">
                <span>Tax Refund</span>
                <span>${{ refundBreakdown.taxRefund.toFixed(2) }}</span>
              </div>
              <div class="breakdown-row penalty">
                <span>Cancellation Penalty (CP)</span>
                <span>-${{ Math.abs(refundBreakdown.cancellationPenalty).toFixed(2) }}</span>
              </div>
              <div class="breakdown-row penalty">
                <span>Service Fee</span>
                <span>-${{ Math.abs(refundBreakdown.serviceFee).toFixed(2) }}</span>
              </div>
            </div>
            <div class="breakdown-total">
              <span>Estimated Refund</span>
              <span class="total-amount">${{ refundBreakdown.estimatedRefund.toFixed(2) }}</span>
            </div>
            <p class="breakdown-note">Final amount subject to airline final audit.</p>

            <!-- Confirmation Checkbox -->
            <label class="confirm-checkbox">
              <input type="checkbox" [(ngModel)]="confirmationChecked">
              <span class="checkmark"></span>
              <span class="confirm-text">I confirm that I have read the fare rules and authorize the cancellation for the selected passengers.</span>
            </label>

            <!-- Confirm Button -->
            <button class="btn-confirm" (click)="confirmCancellation()" [disabled]="!confirmationChecked">
              <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
                <path d="M15 4.5L6.75 12.75L3 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Confirm Cancellation
            </button>
          </div>

          <!-- Help Card -->
          <div class="help-card">
            <div class="help-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="#6B7280" stroke-width="1.5"/>
                <path d="M12 16V12M12 8H12.01" stroke="#6B7280" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </div>
            <div class="help-content">
              <span class="help-title">Need help with this?</span>
              <span class="help-text">Contact our 24/7 Ticketing Desk</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- FooterComponent -->
  <footer class="footer">
    <span>© 2023 B2B Travel Portal | Amadeus GDS Connected | All Transactions are Secure & Encrypted</span>
  </footer>
</div>

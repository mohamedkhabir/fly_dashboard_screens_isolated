<div class="sales-reporting-container">
  <main class="sales-main">
    <div class="container">
      <div class="page-title-section">
        <div>
          <h1>Sales Reporting</h1>
          <p class="subtitle">Analyze your agency's spending and ticket volume across the Amadeus GDS.</p>
        </div>
        <div class="title-actions">
          <button class="btn btn-secondary" (click)="exportReport()">
            <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
              <path d="M9 2V10M9 10L12 7M9 10L6 7M3 12V14C3 14.5304 3.21071 15.0391 3.58579 15.4142C3.96086 15.7893 4.46957 16 5 16H13C13.5304 16 14.0391 15.7893 14.4142 15.4142C14.7893 15.0391 15 14.5304 15 14V12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
            Export Report
          </button>
          <button class="btn btn-primary" (click)="createSchedule()">
            <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
              <path d="M9 5V9L12 10.5M16 9C16 12.866 12.866 16 9 16C5.13401 16 2 12.866 2 9C2 5.13401 5.13401 2 9 2C12.866 2 16 5.13401 16 9Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
            Create Schedule
          </button>
        </div>
      </div>

      <div class="filters-bar">
        <button
          class="filter-button"
          [class.active]="activeFilter === 'last30'"
          (click)="setFilter('last30')"
        >
          Last 30 Days
        </button>
        <button
          class="filter-button"
          [class.active]="activeFilter === 'last6months'"
          (click)="setFilter('last6months')"
        >
          Last 6 Months
        </button>
        <button
          class="filter-button"
          [class.active]="activeFilter === 'lastyear'"
          (click)="setFilter('lastyear')"
        >
          Last Year
        </button>
        <button
          class="filter-button"
          [class.active]="activeFilter === 'custom'"
          (click)="setFilter('custom')"
        >
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
            <rect x="2" y="3" width="12" height="11" rx="1" stroke="currentColor" stroke-width="1.5"/>
            <path d="M2 6H14M5 2V4M11 2V4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
          Custom Range
        </button>
      </div>

      <div class="metrics-grid">
        <div class="metric-card" *ngFor="let metric of metrics">
          <div class="metric-header">
            <span class="metric-title">{{ metric.title }}</span>
            <div class="metric-icon" [ngClass]="metric.icon">
              <svg *ngIf="metric.icon === 'money'" width="24" height="24" viewBox="0 0 24 24" fill="none">
                <rect x="3" y="6" width="18" height="12" rx="2" stroke="currentColor" stroke-width="1.5"/>
                <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="1.5"/>
              </svg>
              <svg *ngIf="metric.icon === 'ticket'" width="24" height="24" viewBox="0 0 24 24" fill="none">
                <rect x="3" y="8" width="18" height="8" rx="1" stroke="currentColor" stroke-width="1.5"/>
                <path d="M3 12H21M9 8V16M15 8V16" stroke="currentColor" stroke-width="1.5"/>
              </svg>
              <svg *ngIf="metric.icon === 'chartz'" width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M3 17L9 11L13 15L21 7M21 7H16M21 7V12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
          </div>
          <div class="metric-value">{{ metric.value }}</div>
          <div class="metric-change" [class.positive]="metric.isPositive" [class.negative]="!metric.isPositive">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
              <path *ngIf="metric.isPositive" d="M7 3V11M7 3L4 6M7 3L10 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
              <path *ngIf="!metric.isPositive" d="M7 11V3M7 11L4 8M7 11L10 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
            <span>{{ metric.change }} vs prev. month</span>
          </div>
        </div>
      </div>

      <!-- ==========================================
     CHART CARD
     ========================================== -->
      <div class="chart-card">

        <!-- Header: title + tabs on LEFT, legend on RIGHT -->
        <div class="chart-header">
          <div class="chart-header-left">
            <h2>Performance Trend</h2>
            <div class="chart-tabs">
              <button
                class="tab-button"
                [class.active]="activeTab === 'spending'"
                (click)="setTab('spending')"
              >Spending</button>
              <button
                class="tab-button"
                [class.active]="activeTab === 'volume'"
                (click)="setTab('volume')"
              >Volume</button>
            </div>
          </div>

          <div class="chart-legend">
            <div class="legend-item">
              <span class="legend-dot current"></span>
              <span>Current Period</span>
            </div>
            <div class="legend-item">
              <span class="legend-dot previous"></span>
              <span>Previous Period</span>
            </div>
          </div>
        </div>

        <!-- Chart body -->
        <div class="chart">
          <div class="chart-bars">
            <div
              class="chart-column"
              *ngFor="let data of chartData; let i = index"
              (mouseenter)="hoveredIndex = i"
              (mouseleave)="hoveredIndex = -1"
            >
              <!-- Tooltip — only on current-period bar, floats above -->
              <div class="bar-tooltip" [class.visible]="hoveredIndex === i && data.isCurrent">
                <span class="tooltip-label">Current:</span>
                <span class="tooltip-value">{{ data.label }}</span>
              </div>

              <!-- Single bar: N segments stacked, white gaps between -->
              <div
                class="bar"
                [class.bar-current]="data.isCurrent"
                [class.bar-previous]="!data.isCurrent"
                [style.height.px]="data.totalHeight"
              >
                <div
                  class="segment"
                  *ngFor="let seg of data.segments"
                  [style.flex]="seg"
                ></div>
              </div>

              <!-- Month label -->
              <div class="chart-label">{{ chartMonths[i] }}</div>
            </div>
          </div>
        </div>
      </div>

      <div class="table-card">
        <div class="table-header">
          <h2>Monthly Breakdown</h2>
          <a href="javascript:void(0)" (click)="viewDetailedTable()" class="view-link">
            View Detailed Table →
          </a>
        </div>

        <div class="table-container">
          <table class="data-table">
            <thead>
            <tr>
              <th>MONTH</th>
              <th>TOTAL REVENUE</th>
              <th>VOLUME (TICKETS)</th>
              <th>TOP CARRIER</th>
              <th>STATUS</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let row of monthlyData">
              <td class="month-cell">{{ row.month }}</td>
              <td class="revenue-cell">${{ row.revenue.toLocaleString('en-US', {minimumFractionDigits: 2}) }}</td>
              <td class="volume-cell">{{ row.volume }}</td>
              <td class="carrier-cell">
                <div class="carrier-info">
                  <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M10 2L15 8H12V14H8V8H5L10 2Z" fill="#0D6EFD"/>
                    <path d="M4 18H16" stroke="#0D6EFD" stroke-width="1.5" stroke-linecap="round"/>
                  </svg>
                  <span>{{ row.carrier }}</span>
                </div>
              </td>
              <td class="status-cell">
                <span class="status-badge closed">{{ row.status }}</span>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </main>
</div>

<div class="user-management-container">

  <main class="main-content">
    <div class="page-header">
      <div>
        <h1>User Management</h1>
        <p class="subtitle">Control employee access and define detailed role permissions for Amadeus operations.</p>
      </div>
      <div class="header-actions">
        <button class="btn btn-secondary" (click)="editRoleMatrix()">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
            <path d="M12 2L16 6L6 16H2V12L12 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
          Edit Role Matrix
        </button>
        <button class="btn btn-primary" (click)="addNewUser()">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
            <circle cx="9" cy="9" r="7" stroke="currentColor" stroke-width="1.5"/>
            <path d="M9 6V12M6 9H12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
          Add New User
        </button>
      </div>
    </div>

    <div class="roles-section">
      <div class="section-title-bar">
        <h2>Roles & Permissions Definition</h2>
        <a href="javascript:void(0)" class="org-policy-link">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
            <path d="M8 2C11.3137 2 14 4.68629 14 8C14 11.3137 11.3137 14 8 14C4.68629 14 2 11.3137 2 8C2 4.68629 4.68629 2 8 2Z" stroke="currentColor" stroke-width="1.5"/>
            <path d="M8 5V8M8 11H8.01" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
          ORGANIZATION POLICY
        </a>
      </div>

      <div class="roles-grid">
        <div class="role-card" *ngFor="let role of roles">
          <div class="role-header">
            <div class="role-icon" [ngClass]="role.name">
              <svg *ngIf="role.name === 'administrator'" width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M12 2L4 5V11C4 16.55 7.84 21.74 12 23C16.16 21.74 20 16.55 20 11V5L12 2Z" stroke="currentColor" stroke-width="2"/>
              </svg>
              <svg *ngIf="role.name === 'booking-agent'" width="24" height="24" viewBox="0 0 24 24" fill="none">
                <circle cx="12" cy="8" r="4" stroke="currentColor" stroke-width="2"/>
                <path d="M6 21C6 17.6863 8.68629 15 12 15C15.3137 15 18 17.6863 18 21" stroke="currentColor" stroke-width="2"/>
              </svg>
              <svg *ngIf="role.name === 'finance'" width="24" height="24" viewBox="0 0 24 24" fill="none">
                <rect x="3" y="6" width="18" height="13" rx="2" stroke="currentColor" stroke-width="2"/>
                <circle cx="17" cy="12" r="2" fill="currentColor"/>
              </svg>
            </div>
            <div class="role-title">
              <h3>{{ role.label }}</h3>
              <span class="default-badge" *ngIf="role.isDefault">DEFAULT</span>
            </div>
          </div>
          <p class="role-description">{{ role.description }}</p>

          <div class="permissions-list">
            <div class="permission-item">
              <div class="permission-label">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
                  <path d="M15 8L9 2L3 8L9 14L15 8Z" fill="currentColor"/>
                </svg>
                <span>Can Issue Tickets</span>
              </div>
              <label class="toggle-switch">
                <input
                  type="checkbox"
                  [checked]="role.permissions.canIssueTickets"
                  (change)="togglePermission(role, 'canIssueTickets')"
                >
                <span class="toggle-slider"></span>
              </label>
            </div>

            <div class="permission-item">
              <div class="permission-label">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
                  <circle cx="9" cy="6" r="3" stroke="currentColor" stroke-width="1.5"/>
                  <path d="M4 15C4 12.7909 5.79086 11 8 11H10C12.2091 11 14 12.7909 14 15" stroke="currentColor" stroke-width="1.5"/>
                </svg>
                <span>Can Manage Users</span>
              </div>
              <label class="toggle-switch">
                <input
                  type="checkbox"
                  [checked]="role.permissions.canManageUsers"
                  (change)="togglePermission(role, 'canManageUsers')"
                >
                <span class="toggle-slider"></span>
              </label>
            </div>

            <div class="permission-item">
              <div class="permission-label">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
                  <rect x="2" y="4" width="14" height="10" rx="1" stroke="currentColor" stroke-width="1.5"/>
                  <circle cx="13" cy="9" r="1" fill="currentColor"/>
                </svg>
                <span>Can Refill Wallet</span>
              </div>
              <label class="toggle-switch">
                <input
                  type="checkbox"
                  [checked]="role.permissions.canRefillWallet"
                  (change)="togglePermission(role, 'canRefillWallet')"
                >
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="team-section">
      <div class="section-header">
        <h2>Active Team Members</h2>
        <div class="search-box">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
            <circle cx="8" cy="8" r="6" stroke="#9CA3AF" stroke-width="1.5"/>
            <path d="M12 12L16 16" stroke="#9CA3AF" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
          <input
            type="text"
            placeholder="Search team members..."
            [(ngModel)]="searchQuery"
          >
        </div>
      </div>

      <div class="table-container">
        <table class="users-table">
          <thead>
          <tr>
            <th>USER PROFILE</th>
            <th>ASSIGNED ROLE</th>
            <th>PERMISSIONS</th>
            <th>STATUS</th>
            <th>ACTIONS</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let user of users">
            <td class="user-cell">
              <div class="user-avatar">{{ user.initials }}</div>
              <div class="user-info">
                <div class="user-name">{{ user.name }}</div>
                <div class="user-email">{{ user.email }}</div>
              </div>
            </td>
            <td>
                <span class="role-badge" [ngClass]="user.role.toLowerCase().replace(' ', '-')">
                  {{ user.role }}
                </span>
            </td>
            <td class="permissions-cell">
              <div class="permission-icons">
                  <span
                    class="permission-icon"
                    *ngFor="let permission of user.permissions"
                    [title]="permission === 'ticket' ? 'Can Issue Tickets' : permission === 'users' ? 'Can Manage Users' : 'Can Refill Wallet'"
                  >
                    <svg *ngIf="permission === 'ticket'" width="20" height="20" viewBox="0 0 20 20" fill="none">
                      <path d="M17 9L10 3L3 9L10 15L17 9Z" fill="currentColor"/>
                    </svg>
                    <svg *ngIf="permission === 'users'" width="20" height="20" viewBox="0 0 20 20" fill="none">
                      <circle cx="10" cy="7" r="3" stroke="currentColor" stroke-width="1.5"/>
                      <path d="M5 17C5 14.2386 7.23858 12 10 12C12.7614 12 15 14.2386 15 17" stroke="currentColor" stroke-width="1.5"/>
                    </svg>
                    <svg *ngIf="permission === 'wallet'" width="20" height="20" viewBox="0 0 20 20" fill="none">
                      <rect x="3" y="5" width="14" height="10" rx="1" stroke="currentColor" stroke-width="1.5"/>
                      <circle cx="14" cy="10" r="1" fill="currentColor"/>
                    </svg>
                  </span>
              </div>
            </td>
            <td>
                <span class="status-badge" [ngClass]="user.status">
                  <span class="status-dot"></span>
                  {{ user.status === 'active' ? 'Active' : 'Inactive' }}
                </span>
            </td>
            <td class="actions-cell">
              <button class="action-button" (click)="viewUser(user)" title="View Details">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
                  <path d="M9 3C4 3 1.5 9 1.5 9S4 15 9 15S16.5 9 16.5 9S14 3 9 3Z" stroke="currentColor" stroke-width="1.5"/>
                  <circle cx="9" cy="9" r="2.5" stroke="currentColor" stroke-width="1.5"/>
                </svg>
              </button>
              <button class="action-button" (click)="editUser(user)" title="Edit User">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
                  <path d="M13 2L16 5L6 15H3V12L13 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
              </button>
            </td>
          </tr>
          </tbody>
        </table>
      </div>

      <div class="pagination">
        <div class="pagination-info">
          Total users: {{ totalUsers }}
        </div>
        <div class="pagination-controls">
          <button
            class="page-button"
            (click)="previousPage()"
            [disabled]="currentPage === 1"
          >
            Previous
          </button>
          <button
            class="page-number"
            [class.active]="currentPage === 1"
            (click)="goToPage(1)"
          >
            1
          </button>
          <button
            class="page-number"
            [class.active]="currentPage === 2"
            (click)="goToPage(2)"
          >
            2
          </button>
          <button
            class="page-button"
            (click)="nextPage()"
          >
            Next
          </button>
        </div>
      </div>
    </div>
  </main>
</div>
